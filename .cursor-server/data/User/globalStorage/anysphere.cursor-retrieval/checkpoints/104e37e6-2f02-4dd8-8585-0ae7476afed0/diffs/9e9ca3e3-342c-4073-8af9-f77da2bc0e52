{"fsPath":"\\home\\hendo420\\soraFeed\\src\\components\\VerticalCarousel.tsx","fileUuid":"9e9ca3e3-342c-4073-8af9-f77da2bc0e52","fileSizeBytes":3955,"numLines":136,"diffChanges":[{"originalStartLineNumberOneIndexed":1,"originalEndLineNumberExclusiveOneIndexed":1,"modifiedStartLineNumberOneIndexed":1,"modifiedEndLineNumberExclusiveOneIndexed":137,"addedLines":["'use client';","","import React, { useCallback, useEffect, useState } from 'react';","import useEmblaCarousel from 'embla-carousel-react';","import { WheelGesturesPlugin } from 'embla-carousel-wheel-gestures';","import { SoraFeedItem } from '@/types/sora';","import VideoCarousel from './VideoCarousel';","","interface VerticalCarouselProps {","  items: SoraFeedItem[];","  onLoadMore?: () => void;","  hasMore?: boolean;","  loadingMore?: boolean;","  onAddToFavorites?: (item: SoraFeedItem) => void;","  onRemoveFromFavorites?: (postId: string) => void;","  isInFavorites?: (postId: string) => boolean;","  onControlsChange?: (showing: boolean) => void;","}","","export default function VerticalCarousel({","  items,","  onLoadMore,","  hasMore,","  loadingMore,","  onAddToFavorites,","  onRemoveFromFavorites,","  isInFavorites,","  onControlsChange","}: VerticalCarouselProps) {","  const [currentIndex, setCurrentIndex] = useState(0);","  ","  // Configure Embla for vertical scrolling with wheel gestures","  const [emblaRef, emblaApi] = useEmblaCarousel(","    {","      axis: 'y',","      loop: false,","      skipSnaps: false,","      dragFree: false,","      containScroll: 'trimSnaps',","      startIndex: 0,","    },","    [WheelGesturesPlugin()]","  );","","  // Handle slide selection","  const onSelect = useCallback(() => {","    if (!emblaApi) return;","    const selectedIndex = emblaApi.selectedScrollSnap();","    setCurrentIndex(selectedIndex);","    ","    // Load more items when approaching the end","    if (hasMore && !loadingMore && selectedIndex >= items.length - 2) {","      onLoadMore?.();","    }","  }, [emblaApi, hasMore, loadingMore, items.length, onLoadMore]);","","  // Set up event listeners","  useEffect(() => {","    if (!emblaApi) return;","    ","    emblaApi.on('select', onSelect);","    onSelect(); // Call once to set initial state","    ","    return () => {","      emblaApi.off('select', onSelect);","    };","  }, [emblaApi, onSelect]);","","  // Keyboard navigation","  useEffect(() => {","    const handleKeyDown = (e: KeyboardEvent) => {","      if (!emblaApi) return;","      ","      // Don't trigger navigation if user is typing in an input field","      const activeElement = document.activeElement;","      const isTyping = activeElement && (","        activeElement.tagName === 'INPUT' || ","        activeElement.tagName === 'TEXTAREA' ||","        (activeElement as HTMLElement).isContentEditable","      );","      ","      if (isTyping) return;","      ","      if (e.key === 'ArrowDown' || e.key === ' ') {","        e.preventDefault();","        emblaApi.scrollNext();","      } else if (e.key === 'ArrowUp') {","        e.preventDefault();","        emblaApi.scrollPrev();","      }","    };","","    window.addEventListener('keydown', handleKeyDown);","    return () => window.removeEventListener('keydown', handleKeyDown);","  }, [emblaApi]);","","  // Navigation functions for external use","  const scrollToNext = useCallback(() => {","    if (emblaApi) emblaApi.scrollNext();","  }, [emblaApi]);","","  const scrollToPrev = useCallback(() => {","    if (emblaApi) emblaApi.scrollPrev();","  }, [emblaApi]);","","  return (","    <div className=\"h-dvh overflow-hidden bg-black\" ref={emblaRef}>","      <div className=\"flex flex-col h-full\">","        {items.map((item, index) => (","          <div ","            key={item.post.id}","            className=\"flex-shrink-0 h-dvh\"","          >","            <VideoCarousel","              item={item}","              isActive={index === currentIndex}","              isUpcoming={index === currentIndex + 1}","              onAddToFavorites={onAddToFavorites}","              onRemoveFromFavorites={onRemoveFromFavorites}","              isInFavorites={isInFavorites}","              onControlsChange={onControlsChange}","            />","          </div>","        ))}","        ","        {/* Loading indicator */}","        {loadingMore && (","          <div className=\"flex-shrink-0 h-dvh flex items-center justify-center bg-black\">","            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-white\"></div>","          </div>","        )}","      </div>","    </div>","  );","}",""],"tokenizedAddedLines":[1000000,1000001,1000002,1000003,1000004,1000005,1000006,1000001,1000007,1000008,1000009,1000010,1000011,1000012,1000013,1000014,1000015,1000016,1000001,1000017,1000018,1000019,1000020,1000021,1000022,1000023,1000024,1000025,1000026,1000027,1000028,1000029,1000030,1000031,1000032,1000033,1000034,1000035,1000036,1000037,1000038,1000039,1000040,1000001,1000041,1000042,1000043,1000044,1000045,1000046,1000047,1000048,1000049,1000050,1000051,1000001,1000052,1000053,1000043,1000046,1000054,1000055,1000046,1000056,1000057,1000058,1000059,1000001,1000060,1000053,1000061,1000062,1000063,1000064,1000065,1000066,1000067,1000068,1000069,1000070,1000063,1000071,1000063,1000072,1000073,1000074,1000075,1000073,1000076,1000077,1000058,1000001,1000078,1000079,1000080,1000001,1000081,1000082,1000083,1000080,1000001,1000084,1000085,1000080,1000001,1000086,1000087,1000088,1000089,1000090,1000091,1000092,1000093,1000094,1000095,1000096,1000097,1000098,1000099,1000100,1000101,1000102,1000103,1000104,1000105,1000106,1000107,1000108,1000109,1000103,1000110,1000111,1000112,1000040,1000016,1000001]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_ADDED"}