{"fsPath":"\\home\\hendo420\\soraFeed\\src\\app\\api\\search\\route.ts","fileUuid":"ebaf73e0-8077-4f44-b06b-46e12851f0a0","fileSizeBytes":1809,"numLines":66,"diffChanges":[{"originalStartLineNumberOneIndexed":1,"originalEndLineNumberExclusiveOneIndexed":1,"modifiedStartLineNumberOneIndexed":1,"modifiedEndLineNumberExclusiveOneIndexed":67,"addedLines":["import { NextRequest, NextResponse } from 'next/server';","import { SoraFeedResponse, SoraFeedItem } from '@/types/sora';","import { getClient } from '@/lib/db';","","export async function GET(request: NextRequest) {","  try {","    const { searchParams } = new URL(request.url);","    const query = searchParams.get('q');","    const limit = parseInt(searchParams.get('limit') || '50');","","    if (!query || query.trim().length === 0) {","      return NextResponse.json(","        { error: 'Search query is required' },","        { status: 400 }","      );","    }","","    console.log('🔍 Searching database for:', query);","","    const client = await getClient();","    ","    // Search using PostgreSQL full-text search","    const searchQuery = `","      SELECT ","        post_data,","        profile_data,","        text,","        posted_at,","        updated_at,","        like_count,","        view_count,","        remix_count,","        permalink","      FROM sora_posts","      WHERE to_tsvector('english', COALESCE(text, '')) @@ plainto_tsquery('english', $1)","      ORDER BY posted_at DESC","      LIMIT $2","    `;","","    const result = await client.query(searchQuery, [query, limit]);","    ","    // Transform database results to SoraFeedItem format","    const items: SoraFeedItem[] = result.rows.map((row: any) => ({","      post: row.post_data,","      profile: row.profile_data,","    }));","","    console.log(`✅ Found ${items.length} results for query: \"${query}\"`);","","    const response: SoraFeedResponse = {","      items,","      cursor: null, // Search doesn't support pagination yet","    };","","    return NextResponse.json(response);","","  } catch (error) {","    console.error('💥 Search error:', error);","    return NextResponse.json(","      { error: 'Internal server error', message: error instanceof Error ? error.message : 'Unknown error' },","      { status: 500 }","    );","  }","}","",""],"tokenizedAddedLines":[1000000,1000001,1000002,1000003,1000004,1000005,1000006,1000007,1000008,1000003,1000009,1000010,1000011,1000012,1000013,1000014,1000003,1000015,1000003,1000016,1000017,1000018,1000019,1000020,1000021,1000022,1000023,1000024,1000025,1000026,1000027,1000028,1000029,1000030,1000031,1000032,1000033,1000034,1000003,1000035,1000017,1000036,1000037,1000038,1000039,1000040,1000003,1000041,1000003,1000042,1000043,1000044,1000045,1000003,1000046,1000003,1000047,1000048,1000049,1000050,1000051,1000052,1000053,1000054,1000003,1000003]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_ADDED"}