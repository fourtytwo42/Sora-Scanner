{"fsPath":"\\home\\hendo420\\soraFeed\\src\\components\\VideoFeed.tsx","fileUuid":"97e11120-eb67-4f8c-a9c9-904b71c529d0","fileSizeBytes":12764,"numLines":387,"diffChanges":[{"originalStartLineNumberOneIndexed":9,"originalEndLineNumberExclusiveOneIndexed":9,"modifiedStartLineNumberOneIndexed":9,"modifiedEndLineNumberExclusiveOneIndexed":10,"addedLines":["import { fetchRemixFeed } from '@/lib/api';"],"tokenizedAddedLines":[1000228]},{"originalStartLineNumberOneIndexed":25,"originalEndLineNumberExclusiveOneIndexed":25,"modifiedStartLineNumberOneIndexed":26,"modifiedEndLineNumberExclusiveOneIndexed":27,"addedLines":["  const [preloadedRemixFeeds, setPreloadedRemixFeeds] = useState<Map<string, SoraFeedItem[]>>(new Map());"],"tokenizedAddedLines":[1000229]},{"originalStartLineNumberOneIndexed":178,"originalEndLineNumberExclusiveOneIndexed":178,"modifiedStartLineNumberOneIndexed":180,"modifiedEndLineNumberExclusiveOneIndexed":243,"addedLines":["","  // Preload remix feeds for upcoming videos","  const preloadRemixFeeds = async () => {","    const preloadPromises: Promise<void>[] = [];","    ","    // Preload remix feeds for next 4-5 videos","    for (let i = 1; i <= 5; i++) {","      const targetIndex = currentIndex + i;","      if (targetIndex < items.length) {","        const item = items[targetIndex];","        const postId = item.post.id;","        ","        // Skip if already preloaded","        if (!preloadedRemixFeeds.has(postId)) {","          const promise = fetchRemixFeed(postId, 10)","            .then((feed) => {","              setPreloadedRemixFeeds(prev => {","                const newMap = new Map(prev);","                newMap.set(postId, feed.items || []);","                return newMap;","              });","            })","            .catch((error) => {","              console.log(`Failed to preload remix feed for ${postId}:`, error);","            });","          ","          preloadPromises.push(promise);","        }","      }","    }","    ","    // Execute all preloads in parallel","    await Promise.allSettled(preloadPromises);","  };","","  // Preload remix feeds when current index changes","  useEffect(() => {","    // Small delay to avoid blocking the main navigation","    const timeoutId = setTimeout(() => {","      preloadRemixFeeds();","    }, 500);","    ","    return () => clearTimeout(timeoutId);","  }, [currentIndex]);","","  // Clean up old preloaded feeds to prevent memory leaks","  useEffect(() => {","    setPreloadedRemixFeeds(prev => {","      const newMap = new Map(prev);","      const keysToDelete: string[] = [];","      ","      // Remove feeds that are more than 10 videos behind current position","      newMap.forEach((_, postId) => {","        const itemIndex = items.findIndex(item => item.post.id === postId);","        if (itemIndex !== -1 && itemIndex < currentIndex - 10) {","          keysToDelete.push(postId);","        }","      });","      ","      keysToDelete.forEach(key => newMap.delete(key));","      return newMap;","    });","  }, [currentIndex, items]);"],"tokenizedAddedLines":[2,1000230,1000231,1000232,104,1000233,1000234,1000235,1000236,1000237,1000238,166,1000239,1000240,1000241,1000242,1000243,1000244,1000245,1000246,1000247,1000248,1000249,1000250,78,36,1000251,41,57,43,104,1000252,1000253,44,2,1000254,119,1000255,1000256,1000257,1000258,104,1000259,121,2,1000260,119,1000261,1000262,1000263,210,1000264,1000265,1000266,1000267,1000268,41,42,210,1000269,1000270,1000271,1000272]},{"originalStartLineNumberOneIndexed":234,"originalEndLineNumberExclusiveOneIndexed":234,"modifiedStartLineNumberOneIndexed":299,"modifiedEndLineNumberExclusiveOneIndexed":300,"addedLines":["            preloadedRemixFeed={preloadedRemixFeeds.get(items[currentIndex].post.id)}"],"tokenizedAddedLines":[1000273]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_MODIFIED"}