{"fsPath":"\\home\\hendo420\\soraFeed\\src\\app\\scanner-debug\\page.tsx","fileUuid":"3d6053e7-03d3-436c-ab4d-0934078d8f48","fileSizeBytes":10692,"numLines":266,"diffChanges":[{"originalStartLineNumberOneIndexed":1,"originalEndLineNumberExclusiveOneIndexed":1,"modifiedStartLineNumberOneIndexed":1,"modifiedEndLineNumberExclusiveOneIndexed":267,"addedLines":["'use client';","","import { useState, useEffect } from 'react';","import { Activity, Database, TrendingUp, AlertCircle, CheckCircle, Clock, XCircle } from 'lucide-react';","","interface ScannerStats {","  scanner: {","    status: string;","    totalScanned: number;","    newPosts: number;","    duplicatePosts: number;","    errors: number;","    lastScanAt: string | null;","    scanDurationMs: number;","    errorMessage: string | null;","  };","  database: {","    totalPosts: number;","    recentPosts: Array<{","      id: string;","      text: string | null;","      posted_at: number;","      indexed_at: string;","      permalink: string | null;","    }>;","    dailyStats: Array<{","      date: string;","      count: string;","    }>;","  };","}","","export default function ScannerDebugPage() {","  const [stats, setStats] = useState<ScannerStats | null>(null);","  const [loading, setLoading] = useState(true);","  const [error, setError] = useState<string | null>(null);","  const [autoRefresh, setAutoRefresh] = useState(true);","","  const fetchStats = async () => {","    try {","      const response = await fetch('/api/scanner/stats');","      if (!response.ok) {","        throw new Error(`HTTP ${response.status}: ${response.statusText}`);","      }","      const data = await response.json();","      setStats(data);","      setError(null);","    } catch (err: any) {","      setError(err.message);","      console.error('Failed to fetch stats:', err);","    } finally {","      setLoading(false);","    }","  };","","  useEffect(() => {","    fetchStats();","    ","    if (autoRefresh) {","      const interval = setInterval(fetchStats, 2000);","      return () => clearInterval(interval);","    }","  }, [autoRefresh]);","","  const getStatusIcon = (status: string) => {","    switch (status) {","      case 'scanning':","        return <Activity className=\"animate-spin text-blue-500\" size={24} />;","      case 'success':","        return <CheckCircle className=\"text-green-500\" size={24} />;","      case 'error':","        return <XCircle className=\"text-red-500\" size={24} />;","      case 'idle':","        return <Clock className=\"text-gray-500\" size={24} />;","      default:","        return <AlertCircle className=\"text-yellow-500\" size={24} />;","    }","  };","","  const formatTimestamp = (timestamp: string | null) => {","    if (!timestamp) return 'Never';","    return new Date(timestamp).toLocaleString();","  };","","  const formatDuration = (ms: number) => {","    if (ms < 1000) return `${ms}ms`;","    return `${(ms / 1000).toFixed(2)}s`;","  };","","  if (loading) {","    return (","      <div className=\"min-h-screen bg-gray-950 flex items-center justify-center\">","        <div className=\"text-white text-xl\">Loading scanner statistics...</div>","      </div>","    );","  }","","  return (","    <div className=\"min-h-screen bg-gray-950 text-white p-8\">","      <div className=\"max-w-7xl mx-auto\">","        {/* Header */}","        <div className=\"flex items-center justify-between mb-8\">","          <div>","            <h1 className=\"text-4xl font-bold mb-2 flex items-center gap-3\">","              <Activity className=\"text-purple-500\" size={36} />","              Scanner Debug Dashboard","            </h1>","            <p className=\"text-gray-400\">Real-time monitoring of the Sora feed scanner</p>","          </div>","          <button","            onClick={() => setAutoRefresh(!autoRefresh)}","            className={`px-4 py-2 rounded-lg transition-all ${","              autoRefresh","                ? 'bg-purple-600 hover:bg-purple-700'","                : 'bg-gray-700 hover:bg-gray-600'","            }`}","          >","            {autoRefresh ? 'üîÑ Auto-refresh ON' : '‚è∏Ô∏è Auto-refresh OFF'}","          </button>","        </div>","","        {error && (","          <div className=\"bg-red-900/50 border border-red-500 rounded-lg p-4 mb-6\">","            <div className=\"flex items-center gap-2\">","              <AlertCircle className=\"text-red-500\" size={20} />","              <span className=\"font-semibold\">Error:</span>","              <span>{error}</span>","            </div>","          </div>","        )}","","        {stats && (","          <>","            {/* Scanner Status */}","            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">","              <div className=\"bg-gray-900 rounded-lg p-6 border border-gray-800\">","                <div className=\"flex items-center justify-between mb-4\">","                  <h3 className=\"text-sm font-semibold text-gray-400\">Status</h3>","                  {getStatusIcon(stats.scanner.status)}","                </div>","                <div className=\"text-2xl font-bold capitalize\">{stats.scanner.status}</div>","              </div>","","              <div className=\"bg-gray-900 rounded-lg p-6 border border-gray-800\">","                <div className=\"flex items-center justify-between mb-4\">","                  <h3 className=\"text-sm font-semibold text-gray-400\">Total Scanned</h3>","                  <TrendingUp className=\"text-purple-500\" size={20} />","                </div>","                <div className=\"text-2xl font-bold\">{stats.scanner.totalScanned.toLocaleString()}</div>","              </div>","","              <div className=\"bg-gray-900 rounded-lg p-6 border border-gray-800\">","                <div className=\"flex items-center justify-between mb-4\">","                  <h3 className=\"text-sm font-semibold text-gray-400\">New Posts</h3>","                  <CheckCircle className=\"text-green-500\" size={20} />","                </div>","                <div className=\"text-2xl font-bold text-green-400\">{stats.scanner.newPosts.toLocaleString()}</div>","              </div>","","              <div className=\"bg-gray-900 rounded-lg p-6 border border-gray-800\">","                <div className=\"flex items-center justify-between mb-4\">","                  <h3 className=\"text-sm font-semibold text-gray-400\">Duplicates</h3>","                  <AlertCircle className=\"text-yellow-500\" size={20} />","                </div>","                <div className=\"text-2xl font-bold text-yellow-400\">{stats.scanner.duplicatePosts.toLocaleString()}</div>","              </div>","            </div>","","            {/* Scanner Details */}","            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8\">","              <div className=\"bg-gray-900 rounded-lg p-6 border border-gray-800\">","                <h3 className=\"text-xl font-bold mb-4 flex items-center gap-2\">","                  <Clock size={24} />","                  Scanner Info","                </h3>","                <div className=\"space-y-3\">","                  <div className=\"flex justify-between\">","                    <span className=\"text-gray-400\">Last Scan:</span>","                    <span className=\"font-mono\">{formatTimestamp(stats.scanner.lastScanAt)}</span>","                  </div>","                  <div className=\"flex justify-between\">","                    <span className=\"text-gray-400\">Scan Duration:</span>","                    <span className=\"font-mono\">{formatDuration(stats.scanner.scanDurationMs)}</span>","                  </div>","                  <div className=\"flex justify-between\">","                    <span className=\"text-gray-400\">Total Errors:</span>","                    <span className={`font-mono ${stats.scanner.errors > 0 ? 'text-red-400' : 'text-green-400'}`}>","                      {stats.scanner.errors}","                    </span>","                  </div>","                  {stats.scanner.errorMessage && (","                    <div className=\"pt-2 border-t border-gray-800\">","                      <span className=\"text-gray-400 block mb-1\">Last Error:</span>","                      <span className=\"text-red-400 text-sm font-mono\">{stats.scanner.errorMessage}</span>","                    </div>","                  )}","                </div>","              </div>","","              <div className=\"bg-gray-900 rounded-lg p-6 border border-gray-800\">","                <h3 className=\"text-xl font-bold mb-4 flex items-center gap-2\">","                  <Database size={24} />","                  Database Stats","                </h3>","                <div className=\"space-y-3\">","                  <div className=\"flex justify-between items-center\">","                    <span className=\"text-gray-400\">Total Posts:</span>","                    <span className=\"text-3xl font-bold text-purple-400\">{stats.database.totalPosts.toLocaleString()}</span>","                  </div>","                  <div className=\"pt-2 border-t border-gray-800\">","                    <span className=\"text-gray-400 block mb-2\">Posts per Day (Last 7 days):</span>","                    <div className=\"space-y-1\">","                      {stats.database.dailyStats.map((day) => (","                        <div key={day.date} className=\"flex justify-between text-sm\">","                          <span className=\"font-mono\">{day.date}</span>","                          <span className=\"text-purple-400 font-semibold\">{parseInt(day.count).toLocaleString()}</span>","                        </div>","                      ))}","                    </div>","                  </div>","                </div>","              </div>","            </div>","","            {/* Recent Posts */}","            <div className=\"bg-gray-900 rounded-lg p-6 border border-gray-800\">","              <h3 className=\"text-xl font-bold mb-4\">Recent Posts (Last 10)</h3>","              <div className=\"overflow-x-auto\">","                <table className=\"w-full\">","                  <thead>","                    <tr className=\"border-b border-gray-800 text-left text-sm text-gray-400\">","                      <th className=\"pb-3 pr-4\">ID</th>","                      <th className=\"pb-3 pr-4\">Text</th>","                      <th className=\"pb-3 pr-4\">Indexed At</th>","                    </tr>","                  </thead>","                  <tbody>","                    {stats.database.recentPosts.map((post) => (","                      <tr key={post.id} className=\"border-b border-gray-800/50\">","                        <td className=\"py-3 pr-4\">","                          <code className=\"text-xs bg-gray-800 px-2 py-1 rounded\">{post.id.slice(0, 12)}...</code>","                        </td>","                        <td className=\"py-3 pr-4 max-w-md truncate\">","                          {post.text ? (","                            <span className=\"text-sm\">{post.text.slice(0, 60)}...</span>","                          ) : (","                            <span className=\"text-gray-500 text-sm italic\">No text</span>","                          )}","                        </td>","                        <td className=\"py-3 pr-4 text-sm font-mono text-gray-400\">","                          {formatTimestamp(post.indexed_at)}","                        </td>","                      </tr>","                    ))}","                  </tbody>","                </table>","              </div>","            </div>","          </>","        )}","      </div>","    </div>","  );","}","",""],"tokenizedAddedLines":[1000000,1000001,1000002,1000003,1000001,1000004,1000005,1000006,1000007,1000008,1000009,1000010,1000011,1000012,1000013,1000014,1000015,1000016,1000017,1000018,1000019,1000020,1000021,1000022,1000023,1000024,1000025,1000026,1000023,1000014,1000027,1000001,1000028,1000029,1000030,1000031,1000032,1000001,1000033,1000034,1000035,1000036,1000037,1000038,1000039,1000040,1000041,1000042,1000043,1000044,1000045,1000046,1000047,1000014,1000001,1000048,1000049,1000050,1000051,1000052,1000053,1000047,1000054,1000001,1000055,1000056,1000057,1000058,1000059,1000060,1000061,1000062,1000063,1000064,1000065,1000066,1000047,1000014,1000001,1000067,1000068,1000069,1000014,1000001,1000070,1000071,1000072,1000014,1000001,1000073,1000074,1000075,1000076,1000077,1000078,1000079,1000001,1000080,1000081,1000082,1000083,1000084,1000085,1000086,1000087,1000088,1000089,1000090,1000091,1000092,1000093,1000094,1000095,1000096,1000097,1000098,1000099,1000100,1000101,1000102,1000001,1000103,1000104,1000105,1000106,1000107,1000108,1000109,1000091,1000110,1000001,1000111,1000112,1000113,1000114,1000115,1000116,1000117,1000118,1000119,1000120,1000121,1000001,1000115,1000116,1000122,1000123,1000119,1000124,1000121,1000001,1000115,1000116,1000125,1000126,1000119,1000127,1000121,1000001,1000115,1000116,1000128,1000129,1000119,1000130,1000121,1000109,1000001,1000131,1000132,1000115,1000133,1000134,1000135,1000136,1000137,1000138,1000139,1000140,1000141,1000138,1000142,1000143,1000141,1000138,1000144,1000145,1000146,1000147,1000141,1000148,1000149,1000150,1000151,1000152,1000153,1000119,1000121,1000001,1000115,1000133,1000154,1000155,1000136,1000137,1000156,1000157,1000158,1000141,1000159,1000160,1000161,1000162,1000163,1000164,1000165,1000166,1000167,1000152,1000141,1000119,1000121,1000109,1000001,1000168,1000169,1000170,1000171,1000172,1000173,1000174,1000175,1000176,1000177,1000178,1000179,1000180,1000181,1000182,1000183,1000184,1000185,1000186,1000187,1000188,1000189,1000190,1000191,1000185,1000192,1000193,1000185,1000194,1000195,1000196,1000197,1000121,1000109,1000198,1000110,1000077,1000199,1000200,1000027,1000001,1000001]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_ADDED"}